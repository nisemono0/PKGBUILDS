# Maintainer: Levente Polyak <anthraxx[at]archlinux[dot]org>
# Maintainer: T.J. Townsend <blakkheim@archlinux.org>
# Contributor: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Contributor: Bartłomiej Piotrowski <bpiotrowski@archlinux.org>
# Contributor: Thorsten Töpper <atsutane-tu@freethoughts.de>
# Contributor: Thayer Williams <thayer@archlinux.org>
# Contributor: Jeff 'codemac' Mickey <jeff@archlinux.org>

# Added some patches

pkgname=dmenu
pkgver=5.2
pkgrel=1
pkgdesc='Generic menu for X'
url='https://tools.suckless.org/dmenu/'
arch=('x86_64')
license=('MIT')
depends=('sh' 'glibc' 'coreutils' 'libx11' 'libxinerama' 'libxft' 'freetype2' 'fontconfig' 'libfontconfig.so')
source=(https://dl.suckless.org/tools/dmenu-${pkgver}.tar.gz
        "dmenu-border-5.2.diff"
        "dmenu-center-5.2.diff"
        "dmenu-dynamic-buffer-5.2.diff"
        "dmenu-linesbelowprompt-and-fullwidth-5.2.diff"
        "dmenu-locale-mod-5.2.diff"
        "dmenu-mousesupport-5.2.diff"
        "dmenu-mousesupport-motion-5.2.diff"
        "dmenu-numbers-5.2.diff"
)

sha512sums=('7be9bb76b11225ec86a30e643e9b884f6d13af581526085212cb7401383d448a72fe4dffc3ce84ffb8319dbf36ca8384597a89070cd27d39d5618f239a2da6e3'
            '3990e7bc822d55de36a025254e98fcc3126d70d0f4cab87f838ec665fc3d1bbbf73dd0003cef04dda0e61bc43c51fe62edae0de9d35901a78384df02e40292f5'
            '4cf12cc68ddec20a2ed6aca7ca48dbec803a1a7438a325d1cfe0366743245e8c14159ed5e063771cb29b4f385f50ee1afef60d5abaf0d53a9c9c7e6a4a284a60'
            '18795af2cfcec764c0ee5aabc0f0f5f5bdd9dc0e7c08dbdae25c15b07adb1ee22faf50916666fc35a345734f85ddc77e70c4371bf88fb8872be9c812cbc0331c'
            'db1681d5637dbb4704e5ac939586a40d7fa0382d8615040787f077921154968e4b36ea247dd481777a2f0fe56d8a654eda8f8a5947f3419fe0058627140ec055'
            '7da6083af61876b6338167b2356120f0aef3f67f083a8c357c05b0b1460788d50b97ecaffdb5d0c658d0b4d6b70eb53562847148c8014d5ec09a6104f31b3cae'
            '7ecac2535c5634c8774cd2a25da1861c4eb603c4eee0b0c88df3ee3c88c4021e4966ab20dbc3affaee5c6b2cf5a8843672b9bdd1b20da19a70b5ff4ab6d01028'
            '5969dbc16e37ba48b9444b412580be41790424b451741bcf3d18aa14f30ca82f805447ba0c34c9c796b515919af6028d71da2fe767423d78764ec266479b2ab7'
            'b58a57f602095efb2b6c82a3f4aca62c0c9c4fac4e2d293420e0c6d1d657ea5371b994e391a94ebbf6600f018f5f62385fd3fc37f036ee3fe9ef467c339946b2'
)

b2sums=('f827f0d0d935f9da8103dbb73ed8b67818f1213d2f8e5a406de5e8c9496ea0479b4ccb50d3a29004abc1e4e679cac177163c02458ed144d323bb50fc120f936d'
        'a774c4c85f88f001808459cf9a26ffb7c87e3ce7324893aae32735b24891f6b08bb28e5b54d1af99c39a1a85a1e2a98172b6814272ac6da228160996254719fd'
        'ca14a5011a0da2e6d6e12d1bc261ce5708f1a39dfff90a34aa586d9a310be8a698ab0d6b33be041b66a40b47f4dc12b7242bd52eb34e5de03f60cf3d0d06ac01'
        '26800389bd26bb5d029e3816bd8f13863ff2e3adcf9feb6d497f30e443b9fda0b7d7cc89dea481121b38b22840ab67211df855d1fac23dc230e7a58055a10d68'
        '063d59109f3d66e783e1b1998aa65886501131119aea42bfdb580ad32447cf152b0dc0f00e1aa21aabd9daa4fabaaf52972cb61c14e583e940299ce12fb98827'
        '5b9b29d5fa2519d9f19108f5412d0fa45c480ccc6f2c4ba252b103703e7547dc0039358035ac1eff5da129b0103ba63fae9b20dbe9b579ab7232b5b82f0f1cbe'
        'ae663382cae3562c1c6de738588b10e8d90a7e9b02cc8bcb18e31f9668629f431557e050f512ea0feab2add39ef20ccab8a40c45e2371efd026ce9366b011518'
        'aec5f5c10a122201dae8d3ab1cd856b362fa18fb575aeb27afa7056ee94b9ebcbbc09f12607583873360b9e6fdac7a01378b52bb006f9d983dd0a98be01387e5'
        '3292ae62790a6110c33d13eae0c00b93df2bb7a13b40b9732a0369f7de2b1010d838eaf6707e50bd87e2c407e81518d5a586d4305b4c58d249d4da2c27c3f338'
)

prepare() {
  cd ${pkgname}-${pkgver}
  echo "CPPFLAGS+=${CPPFLAGS}" >> config.mk
  echo "CFLAGS+=${CFLAGS}" >> config.mk
  echo "LDFLAGS+=${LDFLAGS}" >> config.mk
  
  patch -p1 -i "$srcdir/dmenu-center-5.2.diff"
  patch -p1 -i "$srcdir/dmenu-border-5.2.diff"
  patch -p1 -i "$srcdir/dmenu-mousesupport-5.2.diff"
  patch -p1 -i "$srcdir/dmenu-mousesupport-motion-5.2.diff"
  patch -p1 -i "$srcdir/dmenu-numbers-5.2.diff"
  patch -p1 -i "$srcdir/dmenu-linesbelowprompt-and-fullwidth-5.2.diff"
  patch -p1 -i "$srcdir/dmenu-locale-mod-5.2.diff"
  patch -p1 -i "$srcdir/dmenu-dynamic-buffer-5.2.diff"
}

build() {
  cd ${pkgname}-${pkgver}
  make \
	  X11INC=/usr/include/X11 \
	  X11LIB=/usr/lib/X11 \
	  FREETYPEINC=/usr/include/freetype2
}

package() {
  cd ${pkgname}-${pkgver}
  make PREFIX=/usr DESTDIR="${pkgdir}" install
  install -Dm 644 LICENSE -t "${pkgdir}/usr/share/licenses/${pkgname}"
}

# vim: ts=2 sw=2 et:
